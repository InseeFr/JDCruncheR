<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Score calculation — compute_score • JDCruncheR</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Score calculation — compute_score"><meta name="description" content="To calculate a score for each series from a quality report"><meta property="og:description" content="To calculate a score for each series from a quality report"><meta property="og:image" content="https://inseefr.github.io/JDCruncheR/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">JDCruncheR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Home"><span class="fa fa-home fa-lg"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Package functions</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignette" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignette</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignette"><li><a class="dropdown-item" href="../articles/Using_the_cruncher_with_JDCruncheR.html">Using the cruncher with JDCruncheR</a></li>
    <li><a class="dropdown-item" href="../articles/Lancement_cruncher.html">Utiliser le cruncher avec JDCruncheR</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-jdemetra-" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">JDemetra+</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-jdemetra-"><li><a class="external-link dropdown-item" href="https://github.com/jdemetra/jdemetra-app/releases">To download JDemetra+</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/jdemetra/jwsacruncher/releases">To download the JDemetra+ cruncher</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/InseeFr/JDCruncheR/wiki/Installation-and-set-up-of-JDemetra-and-the-cruncher">Set up with a portable version of Java</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/rjdverse/rjdemetra" aria-label="GitHub"><span class="fa fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Score calculation</h1>
      <small class="dont-index">Source: <a href="https://github.com/InseeFr/JDCruncheR/blob/master/R/QR_functions.R" class="external-link"><code>R/QR_functions.R</code></a></small>
      <div class="d-none name"><code>compute_score.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>To calculate a score for each series from a quality report</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'QR_matrix'</span></span>
<span><span class="fu">compute_score</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  score_pond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>qs_residual_sa_on_sa <span class="op">=</span> <span class="fl">30L</span>, f_residual_sa_on_sa <span class="op">=</span> <span class="fl">30L</span>,</span>
<span>    qs_residual_sa_on_i <span class="op">=</span> <span class="fl">20L</span>, f_residual_sa_on_i <span class="op">=</span> <span class="fl">20L</span>, f_residual_td_on_sa <span class="op">=</span> <span class="fl">30L</span>,</span>
<span>    f_residual_td_on_i <span class="op">=</span> <span class="fl">20L</span>, oos_mean <span class="op">=</span> <span class="fl">15L</span>, oos_mse <span class="op">=</span> <span class="fl">10L</span>, residuals_independency <span class="op">=</span></span>
<span>    <span class="fl">15L</span>, residuals_homoskedasticity <span class="op">=</span> <span class="fl">5L</span>, residuals_skewness <span class="op">=</span> <span class="fl">5L</span>, m7 <span class="op">=</span> <span class="fl">5L</span>, q_m2 <span class="op">=</span> <span class="fl">5L</span><span class="op">)</span>,</span>
<span>  modalities <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Good"</span>, <span class="st">"Uncertain"</span>, <span class="st">""</span>, <span class="st">"Bad"</span>, <span class="st">"Severe"</span><span class="op">)</span>,</span>
<span>  <span class="va">normalize_score_value</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">n_contrib_score</span>,</span>
<span>  conditional_indicator <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"jdc_thresholds"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'mQR_matrix'</span></span>
<span><span class="fu">compute_score</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>a <code><a href="QR_matrix.html">QR_matrix</a></code> or <code><a href="QR_matrix.html">mQR_matrix</a></code> object.</p></dd>


<dt id="arg-score-pond">score_pond<a class="anchor" aria-label="anchor" href="#arg-score-pond"></a></dt>
<dd><p>the formula used to calculate the series score.</p></dd>


<dt id="arg-modalities">modalities<a class="anchor" aria-label="anchor" href="#arg-modalities"></a></dt>
<dd><p>modalities ordered by importance in the score calculation
(cf. details).</p></dd>


<dt id="arg-normalize-score-value">normalize_score_value<a class="anchor" aria-label="anchor" href="#arg-normalize-score-value"></a></dt>
<dd><p>integer indicating the reference value for
weights normalisation. If missing, weights will not be normalised.</p></dd>


<dt id="arg-na-rm">na.rm<a class="anchor" aria-label="anchor" href="#arg-na-rm"></a></dt>
<dd><p>logical indicating whether missing values must be ignored when
calculating the score.</p></dd>


<dt id="arg-n-contrib-score">n_contrib_score<a class="anchor" aria-label="anchor" href="#arg-n-contrib-score"></a></dt>
<dd><p>integer indicating the number of variables to create
in the quality report's values matrix to store the <code>n_contrib_score</code>
greatest contributions to the score (cf. details). If not specified, no
variable is created.</p></dd>


<dt id="arg-conditional-indicator">conditional_indicator<a class="anchor" aria-label="anchor" href="#arg-conditional-indicator"></a></dt>
<dd><p>a <code>list</code> containing 3-elements sub-lists:
"indicator", "conditions" and "condition_modalities". To reduce down to 1 the
weight of chosen indicators depending on other variables' values (cf.
details).</p></dd>


<dt id="arg-thresholds">thresholds<a class="anchor" aria-label="anchor" href="#arg-thresholds"></a></dt>
<dd><p><code>list</code> of numerical vectors. Thresholds applied to the
various tests in order to classify into modalities <code>Good</code>,
<code>Uncertain</code>, <code>Bad</code> and <code>Severe</code>.
By default, the value of the <code>"jdc_threshold"</code> option is used.
You can call the <code><a href="get_thresholds.html">get_thresholds</a></code> function to see what the
<code>thresholds</code> object should look like.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>other unused parameters.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a <code><a href="QR_matrix.html">QR_matrix</a></code> or <code><a href="QR_matrix.html">mQR_matrix</a></code> object.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function <code>compute_score</code> calculates a score from the
modalities of a quality report: to each modality corresponds a weight that
depends on the parameter <code>modalities</code>. The default parameter is
<code>c("Good", "Uncertain", "Bad","Severe")</code>, and the associated weights are
respectively 0, 1, 2 and 3.</p>
<p>The score calculation is based on the <code>score_pond</code> parameter, which is a
named integer vector containing the weights to apply to the (modalities
matrix) variables. For example, with
<code>score_pond = c(qs_residual_sa_on_sa = 10, f_residual_td_on_sa = 5)</code>,
the score will be based on the variables <code>qs_residual_sa_on_sa</code> and
<code>f_residual_td_on_sa</code>. The <code>qs_residual_sa_on_sa</code> grades will be
multiplied by 10 and the <code>f_residual_td_on_sa grades</code>, by 5. To ignore
the missing values when calculating a score, use the parameter
<code>na.rm = TRUE</code>.</p>
<p>The parameter <code>normalize_score_value</code> can be used to normalise the
scores. For example, to have all scores between 0 and 20, specify
<code>normalize_score_value = 20</code>.</p>
<p>When using parameter <code>n_contrib_score</code>, <code>n_contrib_score</code> new
variables are added to the quality report's values matrix. These new
variables store the names of the variables that contribute the most to the
series score. For example, <code>n_contrib_score = 3</code> will add to the values
matrix the three variables that contribute the most to the score. The new
variables' names are <em>i</em>_highest_score, with <em>i</em> being the rank in terms of
contribution to the score (1_highest_score contains the name of the greatest
contributor, 2_highest_score the second greatest, etc). Only the variables
that have a non-zero contribution to the score are taken into account: if a
series score is 0, all <em>i</em>_highest_score variables will be empty. And if a
series score is positive only because of the m7 statistic, 1_highest_score
will have a value of "m7" for this series and the other <em>i</em>_highest_score
will be empty.</p>
<p>Some indicators are only relevant under certain conditions. For example, the
homoscedasticity test is only valid when the residuals are independant, and
the normality tests, only when the residuals are both independant and
homoscedastic. In these cases, the parameter <code>conditional_indicator</code> can
be of use since it reduces the weight of some variables down to 1 when some
conditions are met. <code>conditional_indicator</code> is a <code>list</code> of
3-elements sub-lists:</p><ul><li><p>"indicator": the variable whose weight will be conditionally changed</p></li>
<li><p>"conditions": the variables used to define the conditions</p></li>
<li><p>"conditions_modalities": modalities that must be verified to induce the
weight change For example,
<code>conditional_indicator = list(list(indicator = "residuals_skewness",
  conditions = c("residuals_independency", "residuals_homoskedasticity"),
  conditions_modalities = c("Bad","Severe")))</code>, reduces down to 1 the weight
of the variable "residuals_skewness" when the modalities of the
independancy test ("residuals_independency") or the homoscedasticity test
("residuals_homoskedasticity") are "Bad" or "Severe".</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="fr-compute_score.html">Traduction française</a></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Path of matrix demetra_m</span></span></span>
<span class="r-in"><span><span class="va">demetra_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"JDCruncheR"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="st">"WS/ws_ipi/Output/SAProcessing-1"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"demetra_m.csv"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Extract the quality report from the demetra_m file</span></span></span>
<span class="r-in"><span><span class="va">QR</span> <span class="op">&lt;-</span> <span class="fu"><a href="extract_QR.html">extract_QR</a></span><span class="op">(</span><span class="va">demetra_path</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Multiple column found for extraction of q statistic</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> First column selected</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Multiple column found for extraction of q-m2 statistic</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> First column selected</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculer le score</span></span></span>
<span class="r-in"><span><span class="va">QR</span> <span class="op">&lt;-</span> <span class="fu">compute_score</span><span class="op">(</span><span class="va">QR</span>, n_contrib_score <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">QR</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The quality report matrix has 13 observations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> There are 19 indicators in the modalities matrix and 23 indicators in the values matrix</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The quality report matrix contains the following variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> series  residuals_homoskedasticity  residuals_skewness  residuals_kurtosis  residuals_normality  residuals_independency  qs_residual_sa_on_sa  f_residual_sa_on_sa  qs_residual_sa_on_i  f_residual_sa_on_i  f_residual_td_on_sa  f_residual_td_on_i  oos_mean  oos_mse  q  q_m2  m7  pct_outliers  frequency  arima_model  score  1_highest_contrib_score  2_highest_contrib_score</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The variables exclusively found in the values matrix are:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> frequency  arima_model  1_highest_contrib_score  2_highest_contrib_score</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The smallest score is 30 and the greatest is 560</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The average score is 330.385 and its standard deviation is 194.866</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The following formula was used to calculate the score:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30 * qs_residual_sa_on_sa + 30 * f_residual_sa_on_sa + 20 * qs_residual_sa_on_i + 20 * f_residual_sa_on_i + 30 * f_residual_td_on_sa + 20 * f_residual_td_on_i + 15 * oos_mean + 10 * oos_mse + 15 * residuals_independency + 5 * residuals_homoskedasticity + 5 * residuals_skewness + 5 * m7 + 5 * q_m2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Extract the modalities matrix:</span></span></span>
<span class="r-in"><span><span class="va">QR</span><span class="op">[[</span><span class="st">"modalities"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"score"</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 145  45 300 310  30 195 560 560 505 545 255 310 535</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tanguy Barthelemy, Alain Quartier-la-Tente, Anna Smyk.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

