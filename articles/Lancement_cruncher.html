<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Le lancement du cruncher avec JDCruncheR • JDCruncheR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Le lancement du cruncher avec JDCruncheR">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">JDCruncheR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Home"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Package functions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignette" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignette</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignette">
<li><a class="dropdown-item" href="../articles/Using_the_cruncher_with_JDCruncheR.html">Using the cruncher with JDCruncheR</a></li>
    <li><a class="dropdown-item" href="../articles/Lancement_cruncher.html">Utiliser le cruncher avec JDCruncheR</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-jdemetra-" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">JDemetra+</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-jdemetra-">
<li><a class="external-link dropdown-item" href="https://github.com/jdemetra/jdemetra-app/releases">To download JDemetra+</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/jdemetra/jwsacruncher/releases">To download the JDemetra+ cruncher</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/InseeFr/JDCruncheR/wiki/Installation-and-set-up-of-JDemetra-and-the-cruncher">Set up with a portable version of Java</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rjdverse/rjdemetra" aria-label="GitHub"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Le lancement du cruncher avec JDCruncheR</h1>
            
            <h4 data-toc-skip class="date">2024-09-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/InseeFr/JDCruncheR/blob/main/vignettes/Lancement_cruncher.Rmd" class="external-link"><code>vignettes/Lancement_cruncher.Rmd</code></a></small>
      <div class="d-none name"><code>Lancement_cruncher.Rmd</code></div>
    </div>

    
    
<p>La version actuelle du package JDCruncheR (0.2.4.9000) permet de
faire deux choses :</p>
<ul>
<li>lancer facilement le cruncher de JDemetra+ (<a href="https://github.com/jdemetra/jwsacruncher/releases" class="external-link">JWSACruncher</a>)
pour mettre à jour un workspace et en exporter les résultats.<br>
</li>
<li>calculer un <em>bilan qualité</em> qui permet de synthétiser
l’ensemble des diagnostics liés aux séries désaisonnalisées, afin de
repérer rapidement les séries les plus problématiques sur lesquelles il
faut concentrer son analyse. Ce bilan est surtout utile dans le cas de
la désaisonnalisation d’un grand nombre de séries puisqu’il est dans ce
cas impossible de regarder l’ensemble des diagnostics pour chaque série
dans un temps raisonnable.</li>
</ul>
<div class="section level2">
<h2 id="à-propos-du-cruncher">À propos du cruncher<a class="anchor" aria-label="anchor" href="#%C3%A0-propos-du-cruncher"></a>
</h2>
<p>Pour éviter que le présent package (JDCruncheR) ne soit trop
volumineux, il ne contient pas le cruncher de JDemetra+. Ce dernier peut
être téléchargé à l’adresse suivante: <a href="https://github.com/jdemetra/jdemetra-app/releases" class="external-link uri">https://github.com/jdemetra/jdemetra-app/releases</a>. Pour
plus d’informations sur l’installation du cruncher et sa configuration
avec une version portable de Java, voir le wiki de JDCruncheR : <a href="https://github.com/InseeFr/JDCruncheR/wiki/Installation-&amp;-configuration" class="external-link uri">https://github.com/InseeFr/JDCruncheR/wiki/Installation-&amp;-configuration</a>.</p>
<p>Pour lancer le cruncher de JDemetra+, il faut trois éléments :</p>
<ul>
<li>un fichier contenant les paramètres sur la méthode de
rafraîchissement à utiliser pour mettre le workspace à jour ;<br>
</li>
<li>un workspace valide de JDemetra+ ;<br>
</li>
<li>le chemin d’accès au cruncher.</li>
</ul>
<p>Dans le package JDCruncheR, il existe trois fonctions associées au
lancement du cruncher :</p>
<ul>
<li>
<code>create_param_file()</code> qui permet de créer le fichier de
paramètres ;<br>
</li>
<li>
<code>cruncher()</code> qui permet de lancer le cruncher sur un
workspace à partir d’un fichier de paramètres ;<br>
</li>
<li>
<code>cruncher_and_param()</code> qui permet de lancer le cruncher
tout en créant le fichier de paramètres et de personnaliser certaines
sorties du cruncher.</li>
</ul>
</div>
<div class="section level2">
<h2 id="création-du-fichier-de-paramètres-avec-create_param_file">Création du fichier de paramètres avec
<code>create_param_file()</code><a class="anchor" aria-label="anchor" href="#cr%C3%A9ation-du-fichier-de-param%C3%A8tres-avec-create_param_file"></a>
</h2>
<p>Les paramètres de la fonction <code>create_param_file()</code> sont
les mêmes que ceux décrits dans le wiki du cruncher de JDemetra+ (<a href="https://github.com/jdemetra/jwsacruncher/wiki" class="external-link uri">https://github.com/jdemetra/jwsacruncher/wiki</a>). Les
trois paramètres les plus importants de <code>create_param_file()</code>
sont :</p>
<ol style="list-style-type: decimal">
<li>
<code>policy</code> qui est la méthode de rafraîchissement utilisée
(voir tableau ci-dessous).</li>
</ol>
<table class="table">
<caption>Les différentes politiques de rafraîchissement</caption>
<colgroup>
<col width="22%">
<col width="8%">
<col width="68%">
</colgroup>
<thead><tr class="header">
<th align="left">Option sous JDemetra+</th>
<th align="left">Option du cruncher</th>
<th align="left">Signification</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Partial concurrent adjustment -&gt; Fixed model</td>
<td align="left">current</td>
<td align="left">Le modèle ARIMA, les outliers et les autres paramètres
du modèle de régression ne sont ni ré-identifiés ni ré-estimés. Le
schéma de décomposition est inchangé.</td>
</tr>
<tr class="even">
<td align="left">Partial concurrent adjustment -&gt; Estimate regression
coefficients</td>
<td align="left">fixedparameters (ou fixed)</td>
<td align="left">Le modèle ARIMA, les outliers et les autres paramètres
du modèle regARIMA ne sont pas ré-identifiés. Les coefficients du modèle
ARIMA sont fixés et les autres paramètres du modèle de régression sont
ré-estimés. Le schéma de décomposition est inchangé.</td>
</tr>
<tr class="odd">
<td align="left">Partial concurrent adjustment -&gt; Estimate regression
coefficients + Arima parameters</td>
<td align="left">parameters (paramètre par défaut)</td>
<td align="left">Le modèle ARIMA, les outliers et les autres paramètres
du modèle de régression ne sont pas ré-identifiés mais sont tous
ré-estimés. Le schéma de décomposition est inchangé.</td>
</tr>
<tr class="even">
<td align="left">Partial concurrent adjustment -&gt; Estimate regression
coefficients + Last outliers</td>
<td align="left">lastoutliers</td>
<td align="left">Le modèle ARIMA, les outliers (sauf ceux de la dernière
année) et les autres paramètres du modèle de régression ne sont pas
ré-identifiés mais sont tous ré-estimés. Les outliers de la dernière
année sont ré-identifiés. Le schéma de décomposition est inchangé.</td>
</tr>
<tr class="odd">
<td align="left">Partial concurrent adjustment -&gt; Estimate regression
coefficients + all outliers</td>
<td align="left">outliers</td>
<td align="left">Le modèle ARIMA et les paramètres du modèle regARIMA
autres que les outliers ne sont pas ré-identifiés mais ré-estimés. Tous
les outliers sont ré-identifiés. Le schéma de décomposition est
inchangé.</td>
</tr>
<tr class="even">
<td align="left">Partial concurrent adjustment -&gt; Estimate regression
coefficients + Arima model</td>
<td align="left">stochastic</td>
<td align="left">Ré-identification de tous les paramètres du modèle
regARIMA hormis les variables calendaires. Le schéma de décomposition
est inchangé.</td>
</tr>
<tr class="odd">
<td align="left">Concurrent</td>
<td align="left">complete ou concurrent</td>
<td align="left">Ré-identification de tout le modèle regARIMA.</td>
</tr>
</tbody>
</table>
<ol start="2" style="list-style-type: decimal">
<li>
<code>matrix_item</code> qui est une chaîne de caractères contenant
les noms des paramètres à exporter. Par défaut, ce sont ceux de l’option
<code>default_matrix_item</code>. On peut donc au choix modifier
l’option <code>default_matrix_item</code> ou le paramètre
<code>matrix_item</code> :</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/InseeFr/JDCruncheR" class="external-link">"JDCruncheR"</a></span><span class="op">)</span></span>
<span><span class="co"># Pour afficher les paramètres par défaut :</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"default_matrix_item"</span><span class="op">)</span></span>
<span><span class="co"># Pour modifier les paramètres par défaut pour n'exporter par exemple</span></span>
<span><span class="co"># que les critères d'information :</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>default_matrix_item <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"likelihood.aic"</span>,</span>
<span>    <span class="st">"likelihood.aicc"</span>,</span>
<span>    <span class="st">"likelihood.bic"</span>,</span>
<span>    <span class="st">"likelihood.bicc"</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>
<code>tsmatrix_series</code> qui est une chaîne de caractères
contenant les noms des paramètres à exporter. Par défaut, ce sont ceux
de l’option <code>default_tsmatrix_series</code>. On peut donc au choix
modifier l’option <code>default_tsmatrix_series</code> ou le paramètre
<code>tsmatrix_series</code> :</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Pour afficher les paramètres par défaut :</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"default_tsmatrix_series"</span><span class="op">)</span></span>
<span><span class="co"># Pour modifier les paramètres par défaut pour n'exporter par exemple que</span></span>
<span><span class="co"># la série désaisonnalisée et ses prévisions :</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>default_tsmatrix_series <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sa"</span>, <span class="st">"sa_f"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Pour voir l’ensemble des paramètres, il suffit d’utiliser sous R la
commande <code>?create_param_file</code>.</p>
<p>Après cela, il ne reste plus qu’à créer le fichier de paramètres.
Ci-dessous quelques exemples.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Un fichier parametres.param sera créé sous D:/ avec la politique de rafraîchissement</span></span>
<span><span class="co"># "lastoutliers" et les autres paramètres par défaut</span></span>
<span><span class="fu">create_param_file</span><span class="op">(</span></span>
<span>    dir_file_param <span class="op">=</span> <span class="st">"D:/"</span>,</span>
<span>    policy <span class="op">=</span> <span class="st">"lastoutliers"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Si l'on a modifié les options "default_matrix_item" et "default_tsmatrix_series" pour</span></span>
<span><span class="co"># n'exporter que les critères d'information, la série désaisonnalisée et ses</span></span>
<span><span class="co"># prévisions, la commande précédente est équivalent à :</span></span>
<span><span class="fu">create_param_file</span><span class="op">(</span></span>
<span>    dir_file_param <span class="op">=</span> <span class="st">"D:/"</span>,</span>
<span>    policy <span class="op">=</span> <span class="st">"lastoutliers"</span>,</span>
<span>    matrix_item <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"likelihood.aic"</span>, <span class="st">"likelihood.aicc"</span>,</span>
<span>        <span class="st">"likelihood.bic"</span>, <span class="st">"likelihood.bicc"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    tsmatrix_series <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sa"</span>, <span class="st">"sa_f"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="lancement-du-cruncher">Lancement du cruncher<a class="anchor" aria-label="anchor" href="#lancement-du-cruncher"></a>
</h2>
<p>Pour lancer le cruncher avec <code>cruncher()</code> ou
<code>cruncher_and_param()</code>, il faut spécifier le chemin d’accès
au dossier contenant le cruncher (paramètre
<code>cruncher_bin_directory</code>) ainsi que celui du workspace à
traiter (paramètre <code>workspace</code>).</p>
<p>Par défaut, le chemin d’accès au dossier du cruncher est celui
contenu dans le paramètre <code>cruncher_bin_directory</code> : il
suffit donc de modifier une seule fois cette option afin qu’elle
s’applique à toutes les exécutions du cruncher. Le chemin à indiquer est
celui du dossier contenant le fichier <em>jwsacruncher.bat</em>, situé
dans le dossier “Bin” du dossier d’installation du cruncher. Ainsi, s’il
a été installé sous <code>D:\jdemetra-cli-2.2.3</code>, le fichier
<em>jwsacruncher.bat</em> sera présent sous
<code>D:\jdemetra-cli-2.2.3\bin</code>. Il faut donc modifier l’option
<code>cruncher_bin_directory</code> de la façon suivante :</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>cruncher_bin_directory <span class="op">=</span> <span class="st">"D:/jdemetra-cli-2.2.3/bin/"</span><span class="op">)</span></span></code></pre></div>
<p>Si aucun chemin de workspace n’est renseigné, une fenêtre s’ouvre,
invitant à sélectionner le workspace sur lequel on souhaite lancer le
cruncher.</p>
<p>La fonction <code>cruncher_and_param()</code> permet de créer un
fichier temporaire de paramètres via la fonction
<code>create_param_file()</code>, pour ensuite lancer le cruncher via la
fonction <code>cruncher()</code>. En plus des paramètres disponibles
dans ces deux fonctions, <code>cruncher_and_param()</code> permet de
renommer le dossier contenant les résultats du workspace afin qu’ils
soient égaux aux noms des multi-documents affichés dans l’application
JDemetra+ grâce au paramètre <code>rename_multi_documents</code> (par
défaut <code>rename_multi_documents = TRUE</code> : les dossiers sont
renommés). Ci-dessous quelques exemples d’utilisation.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># La commande suivante permet de mettre à jour le workspace "ipi" présent sous</span></span>
<span><span class="co"># D:/Campagne_CVS/ avec l'option de rafraîchissement "lastoutliers". Les autres</span></span>
<span><span class="co"># options de lancement du cruncher sont ceux par défaut de la fonction create_param_file().</span></span>
<span><span class="co"># En particulier, les paramètres exportés sont ceux des options "default_matrix_item"</span></span>
<span><span class="co"># et "default_tsmatrix_series", et les résultats sortent sous D:/Campagne_CVS/Output/.</span></span>
<span><span class="fu">cruncher_and_param</span><span class="op">(</span></span>
<span>    workspace <span class="op">=</span> <span class="st">"D:/Campagne_CVS/ipi.xml"</span>,</span>
<span>    rename_multi_documents <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    policy <span class="op">=</span> <span class="st">"lastoutliers"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Utilisation du paramètre "output" pour changer le dossier contenant les résultats :</span></span>
<span><span class="fu">cruncher_and_param</span><span class="op">(</span></span>
<span>    workspace <span class="op">=</span> <span class="st">"D:/Campagne_CVS/ipi.xml"</span>,</span>
<span>    output <span class="op">=</span> <span class="st">"D:/Resultats campagne/"</span>,</span>
<span>    rename_multi_documents <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    policy <span class="op">=</span> <span class="st">"lastoutliers"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pour modifier les noms des dossiers contenant les sorties afin qu'ils soient égaux</span></span>
<span><span class="co"># aux noms des multi-documents affichés dans l'application JDemetra+, il suffit</span></span>
<span><span class="co"># d'utiliser le paramètre "rename_multi_documents = TRUE" (valeur par défaut).</span></span>
<span><span class="co"># Le paramètre "delete_existing_file = TRUE" permet, lui, de supprimer les éventuels</span></span>
<span><span class="co"># dossiers existants portant le même nom qu'un des multi-documents.</span></span>
<span><span class="fu">cruncher_and_param</span><span class="op">(</span></span>
<span>    workspace <span class="op">=</span> <span class="st">"D:/Campagne_CVS/ipi.xml"</span>,</span>
<span>    rename_multi_documents <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    delete_existing_file <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    policy <span class="op">=</span> <span class="st">"lastoutliers"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pour voir les autres paramètres de la fonction :</span></span>
<span><span class="op">?</span><span class="va">cruncher_and_param</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tanguy Barthelemy, Alain Quartier-la-Tente, Anna Smyk.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
